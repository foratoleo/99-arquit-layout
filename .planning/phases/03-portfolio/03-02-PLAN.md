---
phase: 03-portfolio
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/portfolio/GalleryGrid.tsx
  - src/hooks/useSwipeGesture.ts
  - src/components/portfolio/FullscreenModal.tsx
autonomous: false
user_setup: []

must_haves:
  truths:
    - "Images lazy load after initial 4-6 images"
    - "Mobile users can swipe left/right between projects in fullscreen modal"
    - "Images load within 1 viewport before visibility"
    - "Pinch-to-zoom works on images in fullscreen modal"
  artifacts:
    - path: "src/hooks/useSwipeGesture.ts"
      provides: "Touch gesture hook for mobile swipe navigation"
      exports: ["useSwipeGesture"]
    - path: "src/components/portfolio/GalleryGrid.tsx"
      provides: "Lazy-loaded grid with first row priority"
      contains: "loading='lazy'|'eager'"
    - path: "src/components/portfolio/FullscreenModal.tsx"
      provides: "Modal with swipe navigation and pinch zoom"
      contains: "useSwipeGesture"
  key_links:
    - from: "src/components/portfolio/FullscreenModal.tsx"
      to: "src/hooks/useSwipeGesture.ts"
      via: "useSwipeGesture hook import"
      pattern: "import.*useSwipeGesture.*from.*@/hooks/useSwipeGesture"
    - from: "src/components/portfolio/GalleryGrid.tsx"
      to: "next/image"
      via: "priority prop on first row images"
      pattern: "priority.*=.*true"
---

<objective>
Implement CLS-safe lazy loading strategy and mobile touch gestures for the portfolio gallery.

Purpose: Performance targets (CLS < 0.1, LCP < 2.5s) require strategic image loading. Mobile users expect native swipe gestures for image navigation - without this, the gallery feels dated and non-premium.

Output: Gallery with optimized lazy loading (first row priority, viewport-based trigger) and mobile swipe navigation in fullscreen modal.
</object>

<execution_context>
@/Users/forato/.claude/get-shit-done/workflows/execute-plan.md
@/Users/forato/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-portfolio/03-CONTEXT.md
@.planning/phases/03-portfolio/03-01-SUMMARY.md

# Context Decisions (LOCKED):
# - Initial load: 4-6 images immediately
# - Trigger distance: 1 viewport before
# - Placeholder style: Solid sand color
# - Priority images: First row priority
# - Swipe action: Horizontal swipe left/right
# - Zoom gestures: Pinch zoom enabled
# - Transition animations: Crossfade
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useSwipeGesture hook for touch navigation</name>
  <files>src/hooks/useSwipeGesture.ts</files>
  <action>
Create src/hooks/useSwipeGesture.ts as a custom hook:

1. Define interface:
   - onSwipeLeft: callback function
   - onSwipeRight: callback function
   - threshold: minimum swipe distance (default 50px)

2. Implement using React refs and touch events:
   - Track touchStartX and touchEndX
   - Calculate swipe distance
   - Trigger callback when threshold exceeded
   - Handle touchstart, touchmove, touchend events

3. Return ref to attach to element

4. Example usage pattern:
   ```ts
   const swipeRef = useSwipeGesture({
     onSwipeLeft: () => nextProject(),
     onSwipeRight: () => prevProject()
   })
   ```

Per context: "Swipe action: Horizontal swipe — swipe left/right to navigate projects"
  </action>
  <verify>Hook compiles without TypeScript errors; exports useSwipeGesture function</verify>
  <done>useSwipeGesture hook provides touch gesture detection with configurable callbacks</done>
</task>

<task type="auto">
  <name>Task 2: Implement CLS-safe lazy loading in GalleryGrid</name>
  <files>src/components/portfolio/GalleryGrid.tsx</files>
  <action>
Update src/components/portfolio/GalleryGrid.tsx:

1. Identify first row images (2 items on desktop, 1 on mobile):
   - Add priority prop to first 2 GalleryItem components (desktop first row)
   - Use loading="eager" for these images

2. Apply lazy loading to remaining images:
   - Use loading="lazy" for images after first row
   - next/image defaults to loading when within 1 viewport (matches context requirement)

3. Add placeholder styling:
   - Set placeholder="blur" or explicit bg-sand color
   - Per context: "Solid sand color while loading"
   - Use bg-sand-200 (or design token color from Phase 1)

4. Verify explicit dimensions:
   - Ensure all GalleryItem images have width/height props
   - This is critical for CLS prevention

Per context decisions:
- "Initial load: 4-6 images immediately" → first row (2) + eager loading
- "Trigger distance: 1 viewport before" → next/image default behavior
- "Priority images: First row priority" → priority prop on first row
  </action>
  <verify>First row images load immediately; remaining images lazy load; no layout shift during loading</verify>
  <done>Gallery loads first row immediately, lazy loads rest with zero CLS</done>
</task>

<task type="auto">
  <name>Task 3: Add swipe navigation to FullscreenModal</name>
  <files>src/components/portfolio/FullscreenModal.tsx</files>
  <action>
Update src/components/portfolio/FullscreenModal.tsx:

1. Import useSwipeGesture from '@/hooks/useSwipeGesture'
2. Import projects data to get project index
3. Add state for currentProjectIndex
4. Implement navigation functions:
   - goToNextProject(): Cycle to next project, wrap to start
   - goToPrevProject(): Cycle to previous project, wrap to end
5. Apply swipe gesture:
   - Attach useSwipeGesture to modal container
   - onSwipeLeft → goToNextProject
   - onSwipeRight → goToPrevProject
6. Add crossfade transition between projects:
   - Use CSS opacity transition
   - Per context: "Crossfade — subtle crossfade between images"
   - Duration: 300-500ms for premium feel
7. Update image when currentProject changes

Per context: "Swipe action: Horizontal swipe — swipe left/right to navigate projects"
  </action>
  <verify>Swiping left goes to next project; swiping right goes to previous; transition is smooth crossfade</verify>
  <done>Fullscreen modal responds to horizontal swipe gestures with smooth crossfade transitions</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete portfolio gallery with lazy loading and mobile swipe gestures</what-built>
  <how-to-verify>
1. Open /portfolio on desktop browser:
   - Open DevTools Network tab
   - Observe first 2 images load immediately (priority)
   - Scroll down - observe remaining images load as you approach
   - Verify no layout shift (content doesn't jump)

2. Test on mobile device or Chrome DevTools mobile emulation:
   - Tap any gallery item to open fullscreen modal
   - Swipe left → should show next project with crossfade
   - Swipe right → should show previous project
   - Verify swipe is responsive and natural
   - Try pinch-to-zoom on modal image

3. Run Lighthouse audit:
   - CLS should be < 0.1
   - LCP should be < 2.5s
   - All images should be WebP/AVIF format

4. Edge cases:
   - Swipe on first project → should wrap to last
   - Swipe on last project → should wrap to first
   - Rapid swipes → should handle gracefully
  </how-to-verify>
  <resume-signal>Type "approved" if lazy loading and swipe gestures work correctly, or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. DevTools Network tab confirms first row images load with high priority
2. Images below fold load as you scroll (within 1 viewport)
3. No layout shift during lazy loading (CLS = 0)
4. Mobile swipe left navigates to next project
5. Mobile swipe right navigates to previous project
6. Crossfade animation is smooth (300-500ms)
7. Pinch-to-zoom works on fullscreen modal images
8. Wraparound works at start/end of project list
</verification>

<success_criteria>
- First row images load immediately (priority + eager)
- Remaining images lazy load within 1 viewport
- Zero CLS during image loading (explicit dimensions)
- Mobile swipe gestures navigate projects smoothly
- Crossfade transitions feel premium, not janky
- Pinch-to-zoom functional on modal images
- Performance targets met: CLS < 0.1, LCP < 2.5s
</success_criteria>

<output>
After completion, create `.planning/phases/03-portfolio/03-02-SUMMARY.md` with:
- Lazy loading strategy implemented (how many priority images)
- Swipe gesture implementation details
- Verification results (CLS score, LCP, mobile testing)
- Any performance issues found and resolved
- User feedback from checkpoint verification
</output>
